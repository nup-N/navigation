# 字符集修复说明

## 问题描述
如果数据库中显示的中文变成问号（????），这是因为数据库字符集不是 UTF-8。

## 解决方案

### 方法 1：执行 SQL 脚本修复（推荐）

1. 连接到 MySQL 数据库：
```bash
mysql -u root -p -P 3307
```

2. 选择数据库：
```sql
USE navigation;
```

3. 执行修复脚本 `fix_charset.sql`：
```bash
mysql -u root -p -P 3307 navigation < fix_charset.sql
```

或者在 MySQL 客户端中直接执行脚本内容。

### 方法 2：手动执行 SQL

在 MySQL 客户端中依次执行以下 SQL：

```sql
-- 修改数据库字符集
ALTER DATABASE navigation CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

-- 修改 categories 表
ALTER TABLE categories CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
ALTER TABLE categories MODIFY COLUMN title VARCHAR(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
ALTER TABLE categories MODIFY COLUMN icon VARCHAR(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

-- 修改 websites 表
ALTER TABLE websites CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
ALTER TABLE websites MODIFY COLUMN title VARCHAR(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
ALTER TABLE websites MODIFY COLUMN url VARCHAR(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
ALTER TABLE websites MODIFY COLUMN description TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
ALTER TABLE websites MODIFY COLUMN icon VARCHAR(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
```

### 方法 3：重新创建数据库（如果数据不重要）

如果现有数据不重要，可以删除并重新创建数据库：

```sql
DROP DATABASE IF EXISTS navigation;
CREATE DATABASE navigation CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
USE navigation;
```

然后重启后端服务，TypeORM 的 `synchronize: true` 会自动创建表结构。

## 注意事项

⚠️ **重要提示**：
- 如果数据库中已经有乱码数据（显示为问号），执行字符集修复后，**已经乱码的数据无法恢复**，需要重新插入正确的数据。
- 修复字符集后，新插入的中文数据会正常显示。
- 建议在修复前备份数据库。

## 验证修复

修复后，可以通过以下方式验证：

1. 在数据库中查询：
```sql
SELECT * FROM categories;
SELECT * FROM websites;
```

2. 通过 API 查询：
```bash
curl http://localhost:3001/categories
curl http://localhost:3001/websites
```

如果返回的数据中中文正常显示，说明修复成功。

